import{n as b,M as v,r as w,am as E,v as k}from"#entry";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const A=()=>{};function T(h,o,s){var n;let a;b(s)?a={evaluating:s}:a={};const{lazy:u=!1,flush:p="pre",evaluating:e=void 0,shallow:d=!0,onError:g=(n=globalThis.reportError)!=null?n:A}=a,f=v(!u),l=d?v(o):w(o);let r=0;return E(async m=>{if(!f.value)return;r++;const c=r;let i=!1;e&&Promise.resolve().then(()=>{e.value=!0});try{const t=await h(y=>{m(()=>{e&&(e.value=!1),i||y()})});c===r&&(l.value=t)}catch(t){g(t)}finally{e&&c===r&&(e.value=!1),i=!0}},{flush:p}),u?k(()=>(f.value=!0,l.value)):l}export{T as c};
